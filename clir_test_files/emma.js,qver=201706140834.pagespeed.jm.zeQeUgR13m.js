jQuery(document).ready(function($){$('.recaptcha-popup').on('click',function(e){$(this).fadeOut(400,function(){$(this).addClass('hidden');$('.activeForm').find('input.waiting').removeClass('waiting');$('.activeForm').removeClass('activeForm');});}).children().click(function(){return false;});$('input[name="validation"]').on('change',function(e){if($(this).val()!==''){var thisForm=$(e.target).closest('#emma-subscription-form');var thisWrap=$(e.target).closest('.emma-wrap');var thisFormUnique=thisForm.attr('data-form-unique');$('#emma-form-submit-'+thisFormUnique).attr('disabled','disabled');}else{$('#emma-form-submit-'+thisFormUnique).removeAttr('disabled');}});$(document).on('click','#emma-form input[name="emma_form_submit"]:not(.waiting)',function(e){e.preventDefault();e.stopPropagation();var thisButton=$(e.target);if($('.activeForm').length>0&&typeof captchaExists!=="undefined"&&!thisButton.hasClass("passed-captcha"))return false;var thisForm=$(e.target).closest('#emma-subscription-form');var thisWrap=$(e.target).closest('.emma-wrap');var thisFormUnique=thisForm.attr('data-form-unique');thisForm.addClass('activeForm');if(typeof captchaExists!=="undefined"){if(!thisButton.hasClass("passed-captcha")){thisButton.addClass("waiting");if($('#recaptcha-container-'+thisFormUnique).children().length==0){grecaptcha.render('recaptcha-container-'+thisFormUnique,{"sitekey":recaptchaSiteKey,"callback":goodCaptcha,});}$('#recaptcha-popup-'+thisFormUnique+'.hidden').fadeIn(400,function(){$(this).removeClass("hidden");});return false;}else{$("#recaptcha-popup-"+thisFormUnique).addClass('hidden').hide();}}if($('.emma-status').length>0){$('.emma-status').fadeOut({duration:300,queue:false,complete:function(){$('.emma-status').remove();}});}thisForm.fadeOut({duration:300,queue:false,complete:function(){$('<div class="spinner"></div>').prependTo(thisWrap).show();var data={'action':'emma_ajax_form_submit','emma_email':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="emma_main_input"]').val(),'emma_firstname':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="emma_firstname"]').val(),'emma_lastname':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="emma_lastname"]').val(),'emma_signup_form_id':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="emma_signup_form_id"]').val(),'emma_send_confirmation':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="emma_send_confirmation"]').val(),'validation':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] input[name="validation"]').val(),'token':$('#emma-subscription-form[data-form-unique="'+thisFormUnique+'"] #g-recaptcha-response').val(),};jQuery.post(ajax_object.ajax_url,data,function(response){var errorClass='';var hasError=false;if(response.data.code>800){errorClass='emma-alert';hasError=true;response.data.tracking_pixel='<p style="display:none !important;">Error occured. No tracking pixel placed.</p>';}else{errorClass='';}thisWrap.prepend('<div class="emma-status '+errorClass+'" style="display:none;">'+response.data.status_txt+'</div>'+response.data.tracking_pixel);$('.spinner').delay(800).fadeOut(300,function(){$('.spinner').remove();$('.emma-status').fadeIn(300);if(hasError==true){thisForm.fadeIn(300);}});});thisForm.removeClass('activeForm');}});});});